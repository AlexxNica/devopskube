<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="DevOpsKube Team">
  
  <title>Setup Redmine SSO - DevOpsKube</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Setup Redmine SSO";
    var mkdocs_page_input_path = "setup/redmine_keycloak.md";
    var mkdocs_page_url = "/setup/redmine_keycloak/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85985871-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DevOpsKube</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../single-node/">Setup Single Node</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../helm/">Setup Helm</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Setup Redmine SSO</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#redmine-sso">Redmine SSO</a></li>
                
                    <li><a class="toctree-l4" href="#keycloak-settings">Keycloak Settings</a></li>
                
                    <li><a class="toctree-l4" href="#redmine-openid-connect-settings">Redmine OpenId Connect Settings</a></li>
                
                    <li><a class="toctree-l4" href="#hints">Hints</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Components</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/gogs/">Gogs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/jenkins/">Jenkins</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/keycloak/">Keycloak</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/kube-lego/">Kube-Lego</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/mysql/">MySQL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/nexus/">TheNexus</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/redmine/">Redmine</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../components/sonarqube/">SonarQube</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>About</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/license/">License</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/team/">Team</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/release-notes/">Release Notes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/roadmap/">Roadmap</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DevOpsKube</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Setup &raquo;</li>
        
      
    
    <li>Setup Redmine SSO</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/devopskube/devopskube/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="redmine-sso">Redmine SSO</h1>
<p>To provide SSO Services in our environemnt, we do use <a href="http://www.keycloak.org/">Keycloak</a> as the central service. To use this in <a href="http://www.redmine.org/">Redmine</a>, we do use a forked and adopted version of the <a href="https://bitbucket.org/triplem74/redmine_openid_connect">OpenId Connect Plugin</a> (Note the two Pull-Requests to the original version of the plugin).</p>
<p>Some configuration changes in the Keycloak System are needed to make this work, these changes are documented in here. Furthermore some hints for the settings of the Redmine OpenId Connect Plugin are shown.  </p>
<h2 id="keycloak-settings">Keycloak Settings</h2>
<p>All Settings done in the Keycloak Server are described in this section.</p>
<h3 id="keycloak-client">Keycloak Client</h3>
<p>The Keycloak client needs to get configured in the following way. The Client needs to havve a unique name (in this case 'redmine') and the 'Access Type' needs to get defined as 'confidential'. Please note especially the 'Valid Redirect URIs', which needs to get set to the URL of the Redmine System (http://loccalhost:3000 in the screenshot).</p>
<p><img alt="Keycloak Redmine Client" src="../../assets/redmine_sso/keycloak_client.png" /></p>
<h3 id="keycloak-credentials">Keycloak Credentials</h3>
<p>Because we have set the 'Access Type' to 'confidential' we do get offered the Credentials Tab. On this tab, we get a secret, which needs to get put into the corresponding Setting of the Redmine OpenId Connect plugin. This secret allows to initiate a secure connection between the Keycloak System and your client application (Redmine in this case).</p>
<p><img alt="Keycloak Credentials" src="../../assets/redmine_sso/keycloak_client_credentials.png" /></p>
<h3 id="keycloak-roles">Keycloak Roles</h3>
<p>The Redmine OpenId Connect plugin provides configuration options to be able to recognize a user as an admin, by using a specific Role and or just a normal User (by using another role and/or by providing no role in the configuration). To be able to use these possibilities, those roles ('User' and 'Admin') need to get configured in the Keycloak Client and later need to get assigned to the concrete user.</p>
<p><img alt="Keycloak Roles" src="../../assets/redmine_sso/keycloak_roles.png" /></p>
<h3 id="keycloak-mappers">Keycloak Mappers</h3>
<p>In order to provide some necessary user information to the Redmine System, the standard Keycloak Mappers have to be adopted and a new Mapper has to get created.</p>
<p><img alt="Keycloak Mapper" src="../../assets/redmine_sso/keycloak_mappers.png" /></p>
<p>The 'username' Mapper is usually mapped to the 'preferred_username' Token Claim Name. This needs to get adopted to 'user_name' in order that the Redmine OpenId Connect Plugin can use this information.</p>
<p><img alt="Keycloak Username Mapper" src="../../assets/redmine_sso/keycloak_mapper_username.png" /></p>
<p>Furthermore the Role Mapper has to get created. This mapper (with the name 'mapper_of') has to be set to be of the Type 'User Client Role', and will contain the Client Role, the user is a member of.   </p>
<p><img alt="Keacloak Role Mapper" src="../../assets/redmine_sso/keycloak_mapper_roles.png" /></p>
<h3 id="keycloak-scope">Keycloak Scope</h3>
<p>It is necessary to assign the wanted Client Roles to the Scope of the Client. This has to be done on the Scope-Tab. Both above created Roles ('User' and 'Admin') have to get assigned to the Scope.</p>
<p><img alt="Keycloak Scope" src="../../assets/redmine_sso/keycloak_scope.png" /></p>
<h2 id="redmine-openid-connect-settings">Redmine OpenId Connect Settings</h2>
<p>The Settings done in the OpenId Connect Plugin Settings page are described in here.</p>
<p>The most relevant settings are the 'Client ID', the 'OpenID Connect server url' and the 'Client Secret'.</p>
<p>The 'Client ID' is the name of the client in your Keycloak System (redmine in our case). By Specification, this should be a URI, but a plain name is working as well, and seems to be easier IMHO.</p>
<p>The 'OpenID Connect server url' has to be set to the Keycloak Server with the path /auth/realms/<REALMNAME>. This is where you can access the dynamic Configuration Settings of Keycloak (https://KEYCLOAK_SERVER/auth/realms/<REALMNAME>). Obviously the KEYCLOAK_SERVER has to be exchanged with the name of the Server, where your Keycloak system is running, and the REALMNAME has to be replaced with the Keycloak Realm, your client is associated to.</p>
<p>The 'Client Secret' is the secret found in the Keycloak Credentials page (see above), and should be copied from there.</p>
<p><img alt="Redmine OpenId Connect Plugin Settings" src="../../assets/redmine_sso/redmine_openid_plugin_setting.png" /></p>
<h2 id="hints">Hints</h2>
<p>In our forked version of the <a href="https://bitbucket.org/triplem74/redmine_openid_connect">Redmine OpenId Connect Plugin</a> we added a setting, to be able to avoid the Validation of SSL Certificates ('Disable Ssl Validation'). This should just be used on Development Systems and not on Production Environments, therefore usage of this setting is on your own risk.</p>
<p>To be still able to login into Redmine during the testing and configuration phase (eg. your Keycloak is not working correctly or your settings in Redmine are not correct already), you can use the login URL with the parameter 'loccal_login', which allows you to login using the Redmine login form (eg. http://localhost:3000/login?local_login=true).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../components/gogs/" class="btn btn-neutral float-right" title="Gogs">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../helm/" class="btn btn-neutral" title="Setup Helm"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>(c) 2016- by the DevOpsKube Team</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/devopskube/devopskube/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../helm/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../components/gogs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
